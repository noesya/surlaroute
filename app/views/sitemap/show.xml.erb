<%
actors_max_updated_at = Actor.published.maximum(:updated_at) || Date.today
tours_max_updated_at = Tour.published.maximum(:updated_at) || Date.today
%>
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc><%= root_url %></loc>
    <lastmod><%= @home_page.updated_at.to_date.iso8601 %></lastmod>
  </url>
  <% @pages.find_each do |page| %>
    <url>
      <loc><%= page_url(page.path) %></loc>
      <lastmod><%= page.updated_at.to_date.iso8601 %></lastmod>
    </url>
  <% end %>
  <url>
    <loc><%= actors_url %></loc>
    <lastmod><%= actors_max_updated_at.to_date.iso8601 %></lastmod>
  </url>
  <% @actors.find_each do |actor| %>
    <url>
      <loc><%= actor_url(actor) %></loc>
      <lastmod><%= actor.updated_at.to_date.iso8601 %></lastmod>
    </url>
  <% end %>
  <url>
    <loc><%= tours_url %></loc>
    <lastmod><%= tours_max_updated_at.to_date.iso8601 %></lastmod>
  </url>
  <% @tours.find_each do |tour| %>
    <url>
      <loc><%= tour_url(tour) %></loc>
      <lastmod><%= tour.updated_at.to_date.iso8601 %></lastmod>
    </url>
  <% end %>
  <url>
    <loc><%= regions_url %></loc>
    <lastmod><%= Region.maximum(:updated_at).to_date.iso8601 %></lastmod>
  </url>
  <% @regions.find_each do |region| %>
    <%
      next if region.empty?
      region_actors_max_updated_at = region.actors.published.maximum(:updated_at) || Date.today
      region_tours_max_updated_at = region.tours.published.maximum(:updated_at) || Date.today
    %>
    <url>
      <loc><%= region_url(region) %></loc>
      <lastmod><%= region.updated_at.to_date.iso8601 %></lastmod>
    </url>
    <url>
      <loc><%= actors_url(region_slug: region.slug) %></loc>
      <lastmod><%= region_actors_max_updated_at.to_date.iso8601 %></lastmod>
    </url>
    <url>
      <loc><%= tours_url(region_slug: region.slug) %></loc>
      <lastmod><%= region_tours_max_updated_at.to_date.iso8601 %></lastmod>
    </url>
  <% end %>
</urlset>
